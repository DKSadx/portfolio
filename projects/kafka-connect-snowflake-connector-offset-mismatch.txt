1:HL["/_next/static/media/162bf645eb375add-s.p.ttf","font",{"crossOrigin":"","type":"font/ttf"}]
2:HL["/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
3:HL["/_next/static/css/d2ee96617fdd9da5.css","style",{"crossOrigin":""}]
0:["S0ycaNWmCna0EqGTlrBnM",[[["",{"children":["projects",{"children":[["slug","kafka-connect-snowflake-connector-offset-mismatch","d"],{"children":["__PAGE__?{\"slug\":\"kafka-connect-snowflake-connector-offset-mismatch\"}",{}]}]}]},"$undefined","$undefined",true],"$L4",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d2ee96617fdd9da5.css","precedence":"next","crossOrigin":""}]],"$L5"]]]]
6:HL["/_next/static/css/4332eee14cae2b92.css","style",{"crossOrigin":""}]
7:I{"id":4089,"chunks":["185:static/chunks/app/layout-c2a58729861ada32.js"],"name":"Analytics","async":false}
8:I{"id":1602,"chunks":["272:static/chunks/webpack-b7788230df343aa2.js","274:static/chunks/f42e5159-56eb28c3a582d27e.js","83:static/chunks/83-0ec6f3c254c9dbc7.js"],"name":"","async":false}
9:I{"id":233,"chunks":["272:static/chunks/webpack-b7788230df343aa2.js","274:static/chunks/f42e5159-56eb28c3a582d27e.js","83:static/chunks/83-0ec6f3c254c9dbc7.js"],"name":"","async":false}
5:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Darko KojoviÄ‡ | DevOps Engineer"}],["$","meta","2",{"name":"description","content":"Lead DevOps Engineer at Atlantbh"}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","4",{"name":"robots","content":"index, follow"}],["$","meta","5",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","meta","6",{"property":"og:title","content":"darko.sh"}],["$","meta","7",{"property":"og:description","content":"Lead DevOps Engineer at Atlantbh"}],["$","meta","8",{"property":"og:url","content":"https://darko.sh"}],["$","meta","9",{"property":"og:site_name","content":"Darko KojoviÄ‡"}],["$","meta","10",{"property":"og:locale","content":"en-US"}],["$","meta","11",{"property":"og:type","content":"website"}],["$","meta","12",{"name":"twitter:card","content":"summary"}],["$","meta","13",{"name":"twitter:title","content":"darko.sh"}],["$","meta","14",{"name":"twitter:description","content":"Lead DevOps Engineer at Atlantbh"}],["$","link","15",{"rel":"shortcut icon","href":"/favicon.png"}],["$","meta","16",{"name":"next-size-adjust"}]]
4:[null,["$","html",null,{"lang":"en","className":"__variable_aaf875 __variable_829c8b","children":[["$","head",null,{"children":["$","$L7",null,{}]}],["$","body",null,{"className":"bg-black undefined","children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":[null,["$","div",null,{"className":"relative min-h-screen bg-gradient-to-tl from-zinc-900 via-zinc-400/10 to-zinc-900 ","children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","projects","children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","projects","children",["slug","kafka-connect-snowflake-connector-offset-mismatch","d"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La","$Lb",null],"segment":"__PAGE__?{\"slug\":\"kafka-connect-snowflake-connector-offset-mismatch\"}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4332eee14cae2b92.css","precedence":"next","crossOrigin":""}]]}],"segment":["slug","kafka-connect-snowflake-connector-offset-mismatch","d"]},"styles":[]}]}],null],"segment":"projects"},"styles":[]}]}]]}],null]
c:I{"id":5415,"chunks":["499:static/chunks/499-57dd4957aac9efe1.js","903:static/chunks/903-24266959a8966958.js","101:static/chunks/app/projects/[slug]/page-4adac04e230db6ff.js"],"name":"Header","async":false}
f:I{"id":918,"chunks":["499:static/chunks/499-57dd4957aac9efe1.js","903:static/chunks/903-24266959a8966958.js","101:static/chunks/app/projects/[slug]/page-4adac04e230db6ff.js"],"name":"","async":false}
d:T2295,
![](https://miro.medium.com/v2/resize:fit:4800/format:webp/1*kjWtWv62U_Bv-ML5KBsSvg.png)

<div
  style={{
    textAlign: 'center',
    fontSize: '0.8rem',
    marginTop: '-4%',
    color: '#6B6B6B',
  }}
>
  <i>Kafka to Snowflake pipeline</i>
</div>

If you're here, your Kafka Connect cluster most likely stopped working and is not inserting any new messages into Snowflake. You checked the logs and saw this WARN message:

```txt
[2024-04-08 16:04:23,507] WARN WorkerSinkTask{id=my-sf-connector}
Ignoring invalid task provided offset my-example-topic-1/OffsetAndMetadata{offset=33500, leaderEpoch=null, metadata=''}
-- not yet consumed, taskOffset=33500 currentOffset=105 (org.apache.kafka.connect.runtime.WorkerSinkTask:426)
```

If you got this message, someone most likely recreated the topic, changed the Kafka cluster or you migrated to a new cluster without copying the **\_\_consumer_offsets** topic. These are some of the possible causes for this issue I can think of.  
Strangely enough, this is only a **WARN** log level even though it means that there is an offset mismatch and messages can't be consumed from that topic.  
This can be dangerous since usually you don't have alerts set up for that log level and if you have a low retention period set on your topics, there's a high risk of losing your precious messages.  
If you're like me, a self proclaimed Kafka Connect expert with no proof or certification, you probably thought that this is a bit inconvenient, but an easy fix.  
I just need to reset the offset for the specific consumer group and recreate the connector. Right?? It's so simple!  
So that's exactly what I did.

### Trying to fix the issue on the Kafka side

1. I first deleted the Snowflake connector by sending a DELETE request to the Kafka Connect connector endpoint

```bash
curl -X DELETE http://localhost:8083/connectors/MY_CONNECTOR_NAME
```

2. Then I had to stop all consumers with that specific consumer group (`consumer.group.id`). Since you can't change offsets with an ACTIVE/STABLE group, the group must be **INACTIVE**. If you have a consumer for DLQ (dead letter queue), don't forget to turn that one off too.  
   To check if there are active consumers, you can use `kafka-consumer-groups.sh` script that comes with every Kafka installation

```bash
./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --command-config config/client-ssl.properties --group ExampleFooGroup --describe
```

3.  After all the consumers are stopped and the group is in an INACTIVE state, I used the same script to reset the offsets

```bash
./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --command-config config/client-ssl.properties --reset-offsets --to-earliest --group ExampleFooGroup --topic MyExampleTopic --execute
```

_This will only reset offsets for `MyExampleTopic` topic, if you want to reset offsets for all topic you can use `--all-topics` flag instead of `--topic`._  
4. I checked the offsets again to make sure the reset happened and recreated the connector

After doing all the steps, the issue **was still there** and the connector was still looking at the old offsets.  
Since I set up and deployed several Kafka Connect clusters and am familiar with a lot of the configuration properties, especially in distributed mode, I was almost certain that the offsets were stored in the topic that was configured via the property `offset.storage.topic`.  
I inspected the topic and, to my surprise, the topic was empty. I double checked everything in case I misconfigured or missed something but everything was looking good. After some research, I found this [Google Groups conversation](https://groups.google.com/g/confluent-platform/c/Zy0I-dJMydM?pli=1) where it says that the `offset.storage.topic` is used only for **source connectors**.  
Sink connectors use the main `__consumer_offsets` topic to store offsets which also stores all the other offsets for all consumer groups in the cluster.

I was confused since I read the documentation for that property a few times and I couldn't recall it mentioning that the property was only for source connectors. I went to check the docs again and there was no mention that the topic is for source connectors only. Not a skill issue, just missing info in the docs; ego restored, let's continue.

> _One similar thing that is mentioned in the docs but can be easily overlooked and is not that obvious is that `group.id` for **sink connectors** is derived from the `consumer.group.id`._

Anyways, I recreated the topic just to be sure but the issue was still there. So the only idea I had left was that the offsets were stored somewhere in Snowflake.

### Trying to fix the issue on the Snowflake side

I opened the Snowsight console and started inspecting the tables that were mapped to the topics which were causing the offset mismatch issues. If you are not familiar with how Snowflake connectors store the data, basically it creates two columns in the specified table, one for the metadata called _RECORD_METADATA_ and one for the messages called _RECORD_CONTENT_. Since _RECORD_CONTENT_ are just the deserialized messages, the only interesting column that was left was _RECORD_METADATA_.  
I inspected the column and interestingly enough, the offset was stored in the metadata!  
Okay, okay, we're onto something here... or at least I thought...  
My idea was that if I clear/empty those columns, then the offsets will be gone and the connector will start from the beginning. So I did just that.

1. I backed up the table in case something went wrong

```sql
create table MY_TABLE_BACKUP clone MY_TABLE;
```

2. Cleared the RECORD_METADATA column aka set it to NULL

```sql
update MY_TABLE set RECORD_METADATA = NULL;
```

3. Recreated the Snowflake connector
4. Profit???

Having already spent more time than I planned on this, I was eagerly waiting for the connector to come up just to see that nothing has changed, the issue was still there. ðŸ˜¢  
I didn't give up, I had one more idea to try!

### Last try and final fix

---

**UPDATE: Big thanks to [Niv Atzmon](https://medium.com/@niv.a_4285) for reaching out and letting me know that there is a better fix than the one I originally found. I won't delete the one I found but I will label it as "workaround". In case that this fix doesn't work for you, you can always try the workaround. Feel free to skip to the "Final fix" section and try that one first.**

---

#### Workaround

Since I tried almost all the ideas I had, the only thing left I could think of was to recreate the Snowflake tables. I couldn't afford to lose the data so I had to also create backups for all the tables.

1. I first backed up all tables that had the offset mismatch issue

```sql
create table MY_TABLE_BACKUP clone MY_TABLE;
create table MY_TABLE_2_BACKUP clone MY_TABLE_2;
```

2. Dropped the old tables

```sql
drop table MY_TABLE;
drop table MY_TABLE_2;
```

3. Cloned the backup tables into new tables that had same names as the ones that were having offset issues

```sql
create table MY_TABLE clone MY_TABLE_BACKUP;
create table MY_TABLE_2 clone MY_TABLE_2_BACKUP;
```

4. Restarted the connector

Surprisingly enough, this **actually worked**! ðŸŽ‰ðŸŽ‰

#### Final fix

What if I told you that there is a fix that doesn't require you dropping your tables and resetting the offset to 0, but rather it lets you set the offset to your desired value?  
Sounds great, but it's not that easy to find.  
If you dig deep enough, you will stumble upon system functions in Snowflake and there is one function that is especially interesting to us. The function is called [SYSTEM$SNOWPIPE_STREAMING_UPDATE_CHANNEL_OFFSET_TOKEN](https://docs.snowflake.com/en/sql-reference/functions/system_snowpipe_streaming_update_channel_offset_token).
If you read the description of the function, it says `"Updates the offset token for a particular channel used by Snowpipe Streaming with a new offset token."` which means that the real location of the offset is in the channel. Now that I think about it, it actually makes sense...

So to finally fix the issue and reset/set the offset, the only thing left to do is to run the function with your table name, channel name and desired offset.

```sql
SYSTEM$SNOWPIPE_STREAMING_UPDATE_CHANNEL_OFFSET_TOKEN('<dbName>.<schemaName>.<tableName>', '<channelName>', '<new_offset_token>');
```

_To reset the offset, set `<new_offset_token>` to `-1`._

In case that you're not sure what the name of your channel is, you can run [SHOW CHANNELS](https://docs.snowflake.com/en/sql-reference/sql/show-channels)

```sql
SHOW CHANNELS;
```

Keep in mind that to edit the channel, you will need to use a role that has write permissions on the targeted table.

Thanks again to [Niv Atzmon](https://medium.com/@niv.a_4285) and the Snowflake team for a more elegant solution.
e:T14bb9,var Component=(()=>{var dr=Object.create;var A=Object.defineProperty;var ir=Object.getOwnPropertyDescriptor;var cr=Object.getOwnPropertyNames;var br=Object.getPrototypeOf,ur=Object.prototype.hasOwnProperty;var V=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports),mr=(c,e)=>{for(var _ in e)A(c,_,{get:e[_],enumerable:!0})},xe=(c,e,_,y)=>{if(e&&typeof e=="object"||typeof e=="function")for(let k of cr(e))!ur.call(c,k)&&k!==_&&A(c,k,{get:()=>e[k],enumerable:!(y=ir(e,k))||y.enumerable});return c};var fr=(c,e,_)=>(_=c!=null?dr(br(c)):{},xe(e||!c||!c.__esModule?A(_,"default",{value:c,enumerable:!0}):_,c)),pr=c=>xe(A({},"__esModule",{value:!0}),c);var ge=V((xr,je)=>{je.exports=React});var Ee=V(G=>{"use strict";(function(){"use strict";var c=ge(),e=Symbol.for("react.element"),_=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),H=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),X=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),Te=Symbol.for("react.offscreen"),J=Symbol.iterator,Fe="@@iterator";function Ce(n){if(n===null||typeof n!="object")return null;var t=J&&n[J]||n[Fe];return typeof t=="function"?t:null}var j=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function m(n){{for(var t=arguments.length,o=new Array(t>1?t-1:0),s=1;s<t;s++)o[s-1]=arguments[s];Re("error",n,o)}}function Re(n,t,o){{var s=j.ReactDebugCurrentFrame,d=s.getStackAddendum();d!==""&&(t+="%s",o=o.concat([d]));var i=o.map(function(l){return String(l)});i.unshift("Warning: "+t),Function.prototype.apply.call(console[n],console,i)}}var Se=!1,Ie=!1,Ae=!1,Oe=!1,Pe=!1,Z;Z=Symbol.for("react.module.reference");function Be(n){return!!(typeof n=="string"||typeof n=="function"||n===y||n===H||Pe||n===k||n===O||n===P||Oe||n===Te||Se||Ie||Ae||typeof n=="object"&&n!==null&&(n.$$typeof===B||n.$$typeof===T||n.$$typeof===z||n.$$typeof===X||n.$$typeof===w||n.$$typeof===Z||n.getModuleId!==void 0))}function De(n,t,o){var s=n.displayName;if(s)return s;var d=t.displayName||t.name||"";return d!==""?o+"("+d+")":o}function Q(n){return n.displayName||"Context"}function h(n){if(n==null)return null;if(typeof n.tag=="number"&&m("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case y:return"Fragment";case _:return"Portal";case H:return"Profiler";case k:return"StrictMode";case O:return"Suspense";case P:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case X:var t=n;return Q(t)+".Consumer";case z:var o=n;return Q(o._context)+".Provider";case w:return De(n,n.render,"ForwardRef");case T:var s=n.displayName||null;return s!==null?s:h(n.type)||"Memo";case B:{var d=n,i=d._payload,l=d._init;try{return h(l(i))}catch{return null}}}return null}var x=Object.assign,U=0,ee,re,ne,te,oe,se,ae;function le(){}le.__reactDisabledLog=!0;function Me(){{if(U===0){ee=console.log,re=console.info,ne=console.warn,te=console.error,oe=console.group,se=console.groupCollapsed,ae=console.groupEnd;var n={configurable:!0,enumerable:!0,value:le,writable:!0};Object.defineProperties(console,{info:n,log:n,warn:n,error:n,group:n,groupCollapsed:n,groupEnd:n})}U++}}function Le(){{if(U--,U===0){var n={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:x({},n,{value:ee}),info:x({},n,{value:re}),warn:x({},n,{value:ne}),error:x({},n,{value:te}),group:x({},n,{value:oe}),groupCollapsed:x({},n,{value:se}),groupEnd:x({},n,{value:ae})})}U<0&&m("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var D=j.ReactCurrentDispatcher,M;function F(n,t,o){{if(M===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);M=s&&s[1]||""}return`
`+M+n}}var L=!1,C;{var Ye=typeof WeakMap=="function"?WeakMap:Map;C=new Ye}function de(n,t){if(!n||L)return"";{var o=C.get(n);if(o!==void 0)return o}var s;L=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var i;i=D.current,D.current=null,Me();try{if(t){var l=function(){throw Error()};if(Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(N){s=N}Reflect.construct(n,[],l)}else{try{l.call()}catch(N){s=N}n.call(l.prototype)}}else{try{throw Error()}catch(N){s=N}n()}}catch(N){if(N&&s&&typeof N.stack=="string"){for(var a=N.stack.split(`
`),f=s.stack.split(`
`),b=a.length-1,u=f.length-1;b>=1&&u>=0&&a[b]!==f[u];)u--;for(;b>=1&&u>=0;b--,u--)if(a[b]!==f[u]){if(b!==1||u!==1)do if(b--,u--,u<0||a[b]!==f[u]){var p=`
`+a[b].replace(" at new "," at ");return n.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",n.displayName)),typeof n=="function"&&C.set(n,p),p}while(b>=1&&u>=0);break}}}finally{L=!1,D.current=i,Le(),Error.prepareStackTrace=d}var E=n?n.displayName||n.name:"",ye=E?F(E):"";return typeof n=="function"&&C.set(n,ye),ye}function We(n,t,o){return de(n,!1)}function qe(n){var t=n.prototype;return!!(t&&t.isReactComponent)}function R(n,t,o){if(n==null)return"";if(typeof n=="function")return de(n,qe(n));if(typeof n=="string")return F(n);switch(n){case O:return F("Suspense");case P:return F("SuspenseList")}if(typeof n=="object")switch(n.$$typeof){case w:return We(n.render);case T:return R(n.type,t,o);case B:{var s=n,d=s._payload,i=s._init;try{return R(i(d),t,o)}catch{}}}return""}var S=Object.prototype.hasOwnProperty,ie={},ce=j.ReactDebugCurrentFrame;function I(n){if(n){var t=n._owner,o=R(n.type,n._source,t?t.type:null);ce.setExtraStackFrame(o)}else ce.setExtraStackFrame(null)}function $e(n,t,o,s,d){{var i=Function.call.bind(S);for(var l in n)if(i(n,l)){var a=void 0;try{if(typeof n[l]!="function"){var f=Error((s||"React class")+": "+o+" type `"+l+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof n[l]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw f.name="Invariant Violation",f}a=n[l](t,l,s,o,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(b){a=b}a&&!(a instanceof Error)&&(I(d),m("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",s||"React class",o,l,typeof a),I(null)),a instanceof Error&&!(a.message in ie)&&(ie[a.message]=!0,I(d),m("Failed %s type: %s",o,a.message),I(null))}}}var Ke=Array.isArray;function Y(n){return Ke(n)}function Ve(n){{var t=typeof Symbol=="function"&&Symbol.toStringTag,o=t&&n[Symbol.toStringTag]||n.constructor.name||"Object";return o}}function Ge(n){try{return be(n),!1}catch{return!0}}function be(n){return""+n}function ue(n){if(Ge(n))return m("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Ve(n)),be(n)}var v=j.ReactCurrentOwner,He={key:!0,ref:!0,__self:!0,__source:!0},me,fe,W;W={};function ze(n){if(S.call(n,"ref")){var t=Object.getOwnPropertyDescriptor(n,"ref").get;if(t&&t.isReactWarning)return!1}return n.ref!==void 0}function Xe(n){if(S.call(n,"key")){var t=Object.getOwnPropertyDescriptor(n,"key").get;if(t&&t.isReactWarning)return!1}return n.key!==void 0}function Je(n,t){if(typeof n.ref=="string"&&v.current&&t&&v.current.stateNode!==t){var o=h(v.current.type);W[o]||(m('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',h(v.current.type),n.ref),W[o]=!0)}}function Ze(n,t){{var o=function(){me||(me=!0,m("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};o.isReactWarning=!0,Object.defineProperty(n,"key",{get:o,configurable:!0})}}function Qe(n,t){{var o=function(){fe||(fe=!0,m("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};o.isReactWarning=!0,Object.defineProperty(n,"ref",{get:o,configurable:!0})}}var er=function(n,t,o,s,d,i,l){var a={$$typeof:e,type:n,key:t,ref:o,props:l,_owner:i};return a._store={},Object.defineProperty(a._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(a,"_self",{configurable:!1,enumerable:!1,writable:!1,value:s}),Object.defineProperty(a,"_source",{configurable:!1,enumerable:!1,writable:!1,value:d}),Object.freeze&&(Object.freeze(a.props),Object.freeze(a)),a};function rr(n,t,o,s,d){{var i,l={},a=null,f=null;o!==void 0&&(ue(o),a=""+o),Xe(t)&&(ue(t.key),a=""+t.key),ze(t)&&(f=t.ref,Je(t,d));for(i in t)S.call(t,i)&&!He.hasOwnProperty(i)&&(l[i]=t[i]);if(n&&n.defaultProps){var b=n.defaultProps;for(i in b)l[i]===void 0&&(l[i]=b[i])}if(a||f){var u=typeof n=="function"?n.displayName||n.name||"Unknown":n;a&&Ze(l,u),f&&Qe(l,u)}return er(n,a,f,d,s,v.current,l)}}var q=j.ReactCurrentOwner,pe=j.ReactDebugCurrentFrame;function g(n){if(n){var t=n._owner,o=R(n.type,n._source,t?t.type:null);pe.setExtraStackFrame(o)}else pe.setExtraStackFrame(null)}var $;$=!1;function K(n){return typeof n=="object"&&n!==null&&n.$$typeof===e}function _e(){{if(q.current){var n=h(q.current.type);if(n)return`

Check the render method of \``+n+"`."}return""}}function nr(n){{if(n!==void 0){var t=n.fileName.replace(/^.*[\\\/]/,""),o=n.lineNumber;return`

Check your code at `+t+":"+o+"."}return""}}var he={};function tr(n){{var t=_e();if(!t){var o=typeof n=="string"?n:n.displayName||n.name;o&&(t=`

Check the top-level render call using <`+o+">.")}return t}}function Ne(n,t){{if(!n._store||n._store.validated||n.key!=null)return;n._store.validated=!0;var o=tr(t);if(he[o])return;he[o]=!0;var s="";n&&n._owner&&n._owner!==q.current&&(s=" It was passed a child from "+h(n._owner.type)+"."),g(n),m('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',o,s),g(null)}}function ke(n,t){{if(typeof n!="object")return;if(Y(n))for(var o=0;o<n.length;o++){var s=n[o];K(s)&&Ne(s,t)}else if(K(n))n._store&&(n._store.validated=!0);else if(n){var d=Ce(n);if(typeof d=="function"&&d!==n.entries)for(var i=d.call(n),l;!(l=i.next()).done;)K(l.value)&&Ne(l.value,t)}}}function or(n){{var t=n.type;if(t==null||typeof t=="string")return;var o;if(typeof t=="function")o=t.propTypes;else if(typeof t=="object"&&(t.$$typeof===w||t.$$typeof===T))o=t.propTypes;else return;if(o){var s=h(t);$e(o,n.props,"prop",s,n)}else if(t.PropTypes!==void 0&&!$){$=!0;var d=h(t);m("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",d||"Unknown")}typeof t.getDefaultProps=="function"&&!t.getDefaultProps.isReactClassApproved&&m("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function sr(n){{for(var t=Object.keys(n.props),o=0;o<t.length;o++){var s=t[o];if(s!=="children"&&s!=="key"){g(n),m("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",s),g(null);break}}n.ref!==null&&(g(n),m("Invalid attribute `ref` supplied to `React.Fragment`."),g(null))}}function ar(n,t,o,s,d,i){{var l=Be(n);if(!l){var a="";(n===void 0||typeof n=="object"&&n!==null&&Object.keys(n).length===0)&&(a+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var f=nr(d);f?a+=f:a+=_e();var b;n===null?b="null":Y(n)?b="array":n!==void 0&&n.$$typeof===e?(b="<"+(h(n.type)||"Unknown")+" />",a=" Did you accidentally export a JSX literal instead of a component?"):b=typeof n,m("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",b,a)}var u=rr(n,t,o,d,i);if(u==null)return u;if(l){var p=t.children;if(p!==void 0)if(s)if(Y(p)){for(var E=0;E<p.length;E++)ke(p[E],n);Object.freeze&&Object.freeze(p)}else m("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ke(p,n)}return n===y?sr(u):or(u),u}}var lr=ar;G.Fragment=y,G.jsxDEV=lr})()});var ve=V((gr,Ue)=>{"use strict";Ue.exports=Ee()});var kr={};mr(kr,{default:()=>Nr,frontmatter:()=>_r});var r=fr(ve()),_r={title:"Kafka Connect Snowflake Connector offset mismatch fix",description:"How to fix offset mismatch and get rid of the error: 'Ignoring invalid task provided offset\u2026' in Kafka Connect Snowflake connector.",date:"2024-04-12",url:"https://dkojovic.medium.com/kafka-connect-snowflake-connector-offset-mismatch-ignoring-invalid-task-provided-offset-6fe3f5424da0",published:!0};function we(c){let e=Object.assign({p:"p",img:"img",div:"div",pre:"pre",code:"code",span:"span",strong:"strong",br:"br",h3:"h3",a:"a",ol:"ol",li:"li",em:"em",blockquote:"blockquote",hr:"hr",h4:"h4"},c.components);return(0,r.jsxDEV)(r.Fragment,{children:[(0,r.jsxDEV)(e.p,{children:(0,r.jsxDEV)(e.img,{src:"https://miro.medium.com/v2/resize:fit:4800/format:webp/1*kjWtWv62U_Bv-ML5KBsSvg.png",alt:""},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:9,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:9,columnNumber:1},this),`
`,(0,r.jsxDEV)("div",{style:{textAlign:"center",fontSize:"0.8rem",marginTop:"-4%",color:"#6B6B6B"},children:(0,r.jsxDEV)("i",{children:"Kafka to Snowflake pipeline"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:19,columnNumber:3},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:11,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:"If you're here, your Kafka Connect cluster most likely stopped working and is not inserting any new messages into Snowflake. You checked the logs and saw this WARN message:"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:22,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"txt","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"txt","data-theme":"default",style:{display:"grid"},children:[(0,r.jsxDEV)(e.span,{"data-line":"",children:(0,r.jsxDEV)(e.span,{style:{color:"#e1e4e8"},children:"[2024-04-08 16:04:23,507] WARN WorkerSinkTask{id=my-sf-connector}"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this),`
`,(0,r.jsxDEV)(e.span,{"data-line":"",children:(0,r.jsxDEV)(e.span,{style:{color:"#e1e4e8"},children:"Ignoring invalid task provided offset my-example-topic-1/OffsetAndMetadata{offset=33500, leaderEpoch=null, metadata=''}"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:20},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.span,{"data-line":"",children:(0,r.jsxDEV)(e.span,{style:{color:"#e1e4e8"},children:"-- not yet consumed, taskOffset=33500 currentOffset=105 (org.apache.kafka.connect.runtime.WorkerSinkTask:426)"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:3,columnNumber:20},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:3,columnNumber:1},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:24,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["If you got this message, someone most likely recreated the topic, changed the Kafka cluster or you migrated to a new cluster without copying the ",(0,r.jsxDEV)(e.strong,{children:"__consumer_offsets"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:30,columnNumber:146},this)," topic. These are some of the possible causes for this issue I can think of.",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:30,columnNumber:246},this),`
`,"Strangely enough, this is only a ",(0,r.jsxDEV)(e.strong,{children:"WARN"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:31,columnNumber:34},this)," log level even though it means that there is an offset mismatch and messages can't be consumed from that topic.",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:31,columnNumber:154},this),`
`,"This can be dangerous since usually you don't have alerts set up for that log level and if you have a low retention period set on your topics, there's a high risk of losing your precious messages.",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:32,columnNumber:197},this),`
`,"If you're like me, a self proclaimed Kafka Connect expert with no proof or certification, you probably thought that this is a bit inconvenient, but an easy fix.",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:33,columnNumber:161},this),`
`,"I just need to reset the offset for the specific consumer group and recreate the connector. Right?? It's so simple!",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:34,columnNumber:116},this),`
`,"So that's exactly what I did."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:30,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.h3,{id:"trying-to-fix-the-issue-on-the-kafka-side",children:[(0,r.jsxDEV)(e.a,{className:"subheading-anchor","aria-label":"Link to section",href:"#trying-to-fix-the-issue-on-the-kafka-side",children:(0,r.jsxDEV)(e.span,{className:"icon icon-link"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this),"Trying to fix the issue on the Kafka side"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:37,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{children:[`
`,(0,r.jsxDEV)(e.li,{children:"I first deleted the Snowflake connector by sending a DELETE request to the Kafka Connect connector endpoint"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:39,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:39,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"bash","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"bash","data-theme":"default",style:{display:"grid"},children:(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"curl"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:144},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"-X"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:181},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:219},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"DELETE"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:256},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:298},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"http://localhost:8083/connectors/MY_CONNECTOR_NAME"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:335},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:41,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{start:"2",children:[`
`,(0,r.jsxDEV)(e.li,{children:["Then I had to stop all consumers with that specific consumer group (",(0,r.jsxDEV)(e.code,{children:"consumer.group.id"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:45,columnNumber:72},this),"). Since you can't change offsets with an ACTIVE/STABLE group, the group must be ",(0,r.jsxDEV)(e.strong,{children:"INACTIVE"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:45,columnNumber:172},this),". If you have a consumer for DLQ (dead letter queue), don't forget to turn that one off too.",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:45,columnNumber:276},this),`
`,"To check if there are active consumers, you can use ",(0,r.jsxDEV)(e.code,{children:"kafka-consumer-groups.sh"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:46,columnNumber:56},this)," script that comes with every Kafka installation"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:45,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:45,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"bash","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"bash","data-theme":"default",style:{display:"grid"},children:(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"./bin/kafka-consumer-groups.sh"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:170},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--bootstrap-server"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:207},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:261},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"localhost:9092"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:298},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:348},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--command-config"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:385},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:437},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"config/client-ssl.properties"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:474},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:538},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--group"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:575},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:618},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"ExampleFooGroup"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:655},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:706},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--describe"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:743},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:48,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{start:"3",children:[`
`,(0,r.jsxDEV)(e.li,{children:"After all the consumers are stopped and the group is in an INACTIVE state, I used the same script to reset the offsets"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:52,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:52,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"bash","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"bash","data-theme":"default",style:{display:"grid"},children:(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"./bin/kafka-consumer-groups.sh"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:170},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--bootstrap-server"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:207},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:261},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"localhost:9092"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:298},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:348},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--command-config"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:385},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:437},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"config/client-ssl.properties"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:474},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:538},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--reset-offsets"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:575},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:626},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--to-earliest"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:663},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:712},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--group"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:749},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:792},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"ExampleFooGroup"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:829},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:880},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--topic"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:917},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:960},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"MyExampleTopic"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:997},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1047},this),(0,r.jsxDEV)(e.span,{style:{color:"#79B8FF"},children:"--execute"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1084},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:54,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:[(0,r.jsxDEV)(e.em,{children:["This will only reset offsets for ",(0,r.jsxDEV)(e.code,{children:"MyExampleTopic"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:58,columnNumber:35},this)," topic, if you want to reset offsets for all topic you can use ",(0,r.jsxDEV)(e.code,{children:"--all-topics"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:58,columnNumber:114},this)," flag instead of ",(0,r.jsxDEV)(e.code,{children:"--topic"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:58,columnNumber:145},this),"."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:58,columnNumber:1},this),(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:58,columnNumber:156},this),`
`,"4. I checked the offsets again to make sure the reset happened and recreated the connector"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:58,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["After doing all the steps, the issue ",(0,r.jsxDEV)(e.strong,{children:"was still there"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:61,columnNumber:38},this)," and the connector was still looking at the old offsets.",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:61,columnNumber:113},this),`
`,"Since I set up and deployed several Kafka Connect clusters and am familiar with a lot of the configuration properties, especially in distributed mode, I was almost certain that the offsets were stored in the topic that was configured via the property ",(0,r.jsxDEV)(e.code,{children:"offset.storage.topic"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:62,columnNumber:252},this),".",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:62,columnNumber:275},this),`
`,"I inspected the topic and, to my surprise, the topic was empty. I double checked everything in case I misconfigured or missed something but everything was looking good. After some research, I found this ",(0,r.jsxDEV)(e.a,{href:"https://groups.google.com/g/confluent-platform/c/Zy0I-dJMydM?pli=1",children:"Google Groups conversation"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:63,columnNumber:204},this)," where it says that the ",(0,r.jsxDEV)(e.code,{children:"offset.storage.topic"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:63,columnNumber:324},this)," is used only for ",(0,r.jsxDEV)(e.strong,{children:"source connectors"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:63,columnNumber:364},this),".",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:63,columnNumber:386},this),`
`,"Sink connectors use the main ",(0,r.jsxDEV)(e.code,{children:"__consumer_offsets"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:64,columnNumber:30},this)," topic to store offsets which also stores all the other offsets for all consumer groups in the cluster."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:61,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:"I was confused since I read the documentation for that property a few times and I couldn't recall it mentioning that the property was only for source connectors. I went to check the docs again and there was no mention that the topic is for source connectors only. Not a skill issue, just missing info in the docs; ego restored, let's continue."},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:66,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.blockquote,{children:[`
`,(0,r.jsxDEV)(e.p,{children:(0,r.jsxDEV)(e.em,{children:["One similar thing that is mentioned in the docs but can be easily overlooked and is not that obvious is that ",(0,r.jsxDEV)(e.code,{children:"group.id"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:68,columnNumber:113},this)," for ",(0,r.jsxDEV)(e.strong,{children:"sink connectors"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:68,columnNumber:128},this)," is derived from the ",(0,r.jsxDEV)(e.code,{children:"consumer.group.id"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:68,columnNumber:168},this),"."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:68,columnNumber:3},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:68,columnNumber:3},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:68,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:"Anyways, I recreated the topic just to be sure but the issue was still there. So the only idea I had left was that the offsets were stored somewhere in Snowflake."},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:70,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.h3,{id:"trying-to-fix-the-issue-on-the-snowflake-side",children:[(0,r.jsxDEV)(e.a,{className:"subheading-anchor","aria-label":"Link to section",href:"#trying-to-fix-the-issue-on-the-snowflake-side",children:(0,r.jsxDEV)(e.span,{className:"icon icon-link"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this),"Trying to fix the issue on the Snowflake side"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:72,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["I opened the Snowsight console and started inspecting the tables that were mapped to the topics which were causing the offset mismatch issues. If you are not familiar with how Snowflake connectors store the data, basically it creates two columns in the specified table, one for the metadata called ",(0,r.jsxDEV)(e.em,{children:"RECORD_METADATA"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:74,columnNumber:299},this)," and one for the messages called ",(0,r.jsxDEV)(e.em,{children:"RECORD_CONTENT"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:74,columnNumber:349},this),". Since ",(0,r.jsxDEV)(e.em,{children:"RECORD_CONTENT"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:74,columnNumber:373},this)," are just the deserialized messages, the only interesting column that was left was ",(0,r.jsxDEV)(e.em,{children:"RECORD_METADATA"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:74,columnNumber:472},this),".",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:74,columnNumber:490},this),`
`,"I inspected the column and interestingly enough, the offset was stored in the metadata!",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:75,columnNumber:88},this),`
`,"Okay, okay, we're onto something here... or at least I thought...",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:76,columnNumber:66},this),`
`,"My idea was that if I clear/empty those columns, then the offsets will be gone and the connector will start from the beginning. So I did just that."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:74,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{children:[`
`,(0,r.jsxDEV)(e.li,{children:"I backed up the table in case something went wrong"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:79,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:79,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"sql","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"sql","data-theme":"default",style:{display:"grid"},children:(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"create"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:146},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"table"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:183},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:224},this),(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"MY_TABLE_BACKUP"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:261},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" clone MY_TABLE;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:312},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:81,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{start:"2",children:[`
`,(0,r.jsxDEV)(e.li,{children:"Cleared the RECORD_METADATA column aka set it to NULL"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:85,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:85,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"sql","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"sql","data-theme":"default",style:{display:"grid"},children:(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"update"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" MY_TABLE "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:146},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"set"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:192},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" RECORD_METADATA "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:231},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"="},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:284},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:321},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"NULL"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:358},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:";"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:398},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:87,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{start:"3",children:[`
`,(0,r.jsxDEV)(e.li,{children:"Recreated the Snowflake connector"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:91,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.li,{children:"Profit???"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:92,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:91,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["Having already spent more time than I planned on this, I was eagerly waiting for the connector to come up just to see that nothing has changed, the issue was still there. \u{1F622}",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:94,columnNumber:174},this),`
`,"I didn't give up, I had one more idea to try!"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:94,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.h3,{id:"last-try-and-final-fix",children:[(0,r.jsxDEV)(e.a,{className:"subheading-anchor","aria-label":"Link to section",href:"#last-try-and-final-fix",children:(0,r.jsxDEV)(e.span,{className:"icon icon-link"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this),"Last try and final fix"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:97,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.hr,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:99,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:(0,r.jsxDEV)(e.strong,{children:["UPDATE: Big thanks to ",(0,r.jsxDEV)(e.a,{href:"https://medium.com/@niv.a_4285",children:"Niv Atzmon"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:101,columnNumber:25},this),` for reaching out and letting me know that there is a better fix than the one I originally found. I won't delete the one I found but I will label it as "workaround". In case that this fix doesn't work for you, you can always try the workaround. Feel free to skip to the "Final fix" section and try that one first.`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:101,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:101,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.hr,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:103,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.h4,{id:"workaround",children:[(0,r.jsxDEV)(e.a,{className:"subheading-anchor","aria-label":"Link to section",href:"#workaround",children:(0,r.jsxDEV)(e.span,{className:"icon icon-link"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this),"Workaround"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:105,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:"Since I tried almost all the ideas I had, the only thing left I could think of was to recreate the Snowflake tables. I couldn't afford to lose the data so I had to also create backups for all the tables."},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:107,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{children:[`
`,(0,r.jsxDEV)(e.li,{children:"I first backed up all tables that had the offset mismatch issue"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:109,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:109,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"sql","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"sql","data-theme":"default",style:{display:"grid"},children:[(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"create"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:146},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"table"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:183},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:224},this),(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"MY_TABLE_BACKUP"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:261},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" clone MY_TABLE;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:312},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this),`
`,(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"create"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:20},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:62},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"table"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:99},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:140},this),(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"MY_TABLE_2_BACKUP"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:177},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" clone MY_TABLE_2;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:230},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:1},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:111,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{start:"2",children:[`
`,(0,r.jsxDEV)(e.li,{children:"Dropped the old tables"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:116,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:116,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"sql","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"sql","data-theme":"default",style:{display:"grid"},children:[(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"drop"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:144},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"table"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:181},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" MY_TABLE;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:222},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this),`
`,(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"drop"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:20},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:60},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"table"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:97},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" MY_TABLE_2;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:138},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:1},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:118,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{start:"3",children:[`
`,(0,r.jsxDEV)(e.li,{children:"Cloned the backup tables into new tables that had same names as the ones that were having offset issues"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:123,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:123,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"sql","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"sql","data-theme":"default",style:{display:"grid"},children:[(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"create"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:146},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"table"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:183},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:224},this),(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"MY_TABLE"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:261},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" clone MY_TABLE_BACKUP;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:305},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this),`
`,(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"create"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:20},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:62},this),(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"table"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:99},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:140},this),(0,r.jsxDEV)(e.span,{style:{color:"#B392F0"},children:"MY_TABLE_2"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:177},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:" clone MY_TABLE_2_BACKUP;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:223},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:2,columnNumber:1},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:125,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.ol,{start:"4",children:[`
`,(0,r.jsxDEV)(e.li,{children:"Restarted the connector"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:130,columnNumber:1},this),`
`]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:130,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["Surprisingly enough, this ",(0,r.jsxDEV)(e.strong,{children:"actually worked"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:132,columnNumber:27},this),"! \u{1F389}\u{1F389}"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:132,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.h4,{id:"final-fix",children:[(0,r.jsxDEV)(e.a,{className:"subheading-anchor","aria-label":"Link to section",href:"#final-fix",children:(0,r.jsxDEV)(e.span,{className:"icon icon-link"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this),"Final fix"]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:134,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["What if I told you that there is a fix that doesn't require you dropping your tables and resetting the offset to 0, but rather it lets you set the offset to your desired value?",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:136,columnNumber:177},this),`
`,"Sounds great, but it's not that easy to find.",(0,r.jsxDEV)(e.br,{},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:137,columnNumber:46},this),`
`,"If you dig deep enough, you will stumble upon system functions in Snowflake and there is one function that is especially interesting to us. The function is called ",(0,r.jsxDEV)(e.a,{href:"https://docs.snowflake.com/en/sql-reference/functions/system_snowpipe_streaming_update_channel_offset_token",children:"SYSTEM$SNOWPIPE_STREAMING_UPDATE_CHANNEL_OFFSET_TOKEN"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:138,columnNumber:164},this),`.
If you read the description of the function, it says `,(0,r.jsxDEV)(e.code,{children:'"Updates the offset token for a particular channel used by Snowpipe Streaming with a new offset token."'},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:139,columnNumber:54},this)," which means that the real location of the offset is in the channel. Now that I think about it, it actually makes sense..."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:136,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:"So to finally fix the issue and reset/set the offset, the only thing left to do is to run the function with your table name, channel name and desired offset."},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:141,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"sql","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"sql","data-theme":"default",style:{display:"grid"},children:(0,r.jsxDEV)(e.span,{"data-line":"",children:[(0,r.jsxDEV)(e.span,{style:{color:"#F97583"},children:"SYSTEM"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:"$SNOWPIPE_STREAMING_UPDATE_CHANNEL_OFFSET_TOKEN("},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:146},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"'<dbName>.<schemaName>.<tableName>'"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:230},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:", "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:327},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"'<channelName>'"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:365},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:", "},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:430},this),(0,r.jsxDEV)(e.span,{style:{color:"#9ECBFF"},children:"'<new_offset_token>'"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:468},this),(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:");"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:538},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:143,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:(0,r.jsxDEV)(e.em,{children:["To reset the offset, set ",(0,r.jsxDEV)(e.code,{children:"<new_offset_token>"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:147,columnNumber:27},this)," to ",(0,r.jsxDEV)(e.code,{children:"-1"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:147,columnNumber:51},this),"."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:147,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:147,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["In case that you're not sure what the name of your channel is, you can run ",(0,r.jsxDEV)(e.a,{href:"https://docs.snowflake.com/en/sql-reference/sql/show-channels",children:"SHOW CHANNELS"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:149,columnNumber:76},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:149,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsxDEV)(e.pre,{style:{backgroundColor:"#24292e"},tabIndex:"0","data-language":"sql","data-theme":"default",children:(0,r.jsxDEV)(e.code,{"data-language":"sql","data-theme":"default",style:{display:"grid"},children:(0,r.jsxDEV)(e.span,{"data-line":"",children:(0,r.jsxDEV)(e.span,{style:{color:"#E1E4E8"},children:"SHOW CHANNELS;"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:104},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:85},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:151,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:"Keep in mind that to edit the channel, you will need to use a role that has write permissions on the targeted table."},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:155,columnNumber:1},this),`
`,(0,r.jsxDEV)(e.p,{children:["Thanks again to ",(0,r.jsxDEV)(e.a,{href:"https://medium.com/@niv.a_4285",children:"Niv Atzmon"},void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:157,columnNumber:17},this)," and the Snowflake team for a more elegant solution."]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:157,columnNumber:1},this)]},void 0,!0,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx",lineNumber:1,columnNumber:1},this)}function hr(c={}){let{wrapper:e}=c.components||{};return e?(0,r.jsxDEV)(e,Object.assign({},c,{children:(0,r.jsxDEV)(we,c,void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this)}),void 0,!1,{fileName:"/Users/darko/personal_projects/darko.sh/content/projects/_mdx_bundler_entry_point-5e5e683b-e7a9-4b67-b8ef-e66e8c0055b1.mdx"},this):we(c)}var Nr=hr;return pr(kr);})();
/*! Bundled license information:

react/cjs/react-jsx-dev-runtime.development.js:
  (**
   * @license React
   * react-jsx-dev-runtime.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
;return Component;b:["$","div",null,{"className":"bg-zinc-50 min-h-screen","children":[["$","$Lc",null,{"project":{"published":true,"title":"Kafka Connect Snowflake Connector offset mismatch fix","description":"How to fix offset mismatch and get rid of the error: 'Ignoring invalid task provided offsetâ€¦' in Kafka Connect Snowflake connector.","date":"2024-04-12T00:00:00.000Z","url":"https://dkojovic.medium.com/kafka-connect-snowflake-connector-offset-mismatch-ignoring-invalid-task-provided-offset-6fe3f5424da0","body":{"raw":"$d","code":"$e"},"_id":"projects/kafka-connect-snowflake-connector-offset-mismatch.mdx","_raw":{"sourceFilePath":"projects/kafka-connect-snowflake-connector-offset-mismatch.mdx","sourceFileName":"kafka-connect-snowflake-connector-offset-mismatch.mdx","sourceFileDir":"projects","contentType":"mdx","flattenedPath":"projects/kafka-connect-snowflake-connector-offset-mismatch"},"type":"Project","path":"/projects/kafka-connect-snowflake-connector-offset-mismatch","slug":"kafka-connect-snowflake-connector-offset-mismatch"}}],["$","article",null,{"className":"px-4 py-12 mx-auto prose prose-zinc prose-quoteless","children":["$","div",null,{"className":"mdx","children":[["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["$","img",null,{"className":"rounded-md border border-zinc-200","alt":"","src":"https://miro.medium.com/v2/resize:fit:4800/format:webp/1*kjWtWv62U_Bv-ML5KBsSvg.png"}]}],"\n",["$","div",null,{"style":{"textAlign":"center","fontSize":"0.8rem","marginTop":"-4%","color":"#6B6B6B"},"children":["$","i",null,{"children":"Kafka to Snowflake pipeline"}]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":"If you're here, your Kafka Connect cluster most likely stopped working and is not inserting any new messages into Snowflake. You checked the logs and saw this WARN message:"}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"txt","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"txt","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#e1e4e8"},"children":"[2024-04-08 16:04:23,507] WARN WorkerSinkTask{id=my-sf-connector}"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#e1e4e8"},"children":"Ignoring invalid task provided offset my-example-topic-1/OffsetAndMetadata{offset=33500, leaderEpoch=null, metadata=''}"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#e1e4e8"},"children":"-- not yet consumed, taskOffset=33500 currentOffset=105 (org.apache.kafka.connect.runtime.WorkerSinkTask:426)"}]}]]}]}]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["If you got this message, someone most likely recreated the topic, changed the Kafka cluster or you migrated to a new cluster without copying the ",["$","strong",null,{"children":"__consumer_offsets"}]," topic. These are some of the possible causes for this issue I can think of.",["$","br",null,{}],"\n","Strangely enough, this is only a ",["$","strong",null,{"children":"WARN"}]," log level even though it means that there is an offset mismatch and messages can't be consumed from that topic.",["$","br",null,{}],"\n","This can be dangerous since usually you don't have alerts set up for that log level and if you have a low retention period set on your topics, there's a high risk of losing your precious messages.",["$","br",null,{}],"\n","If you're like me, a self proclaimed Kafka Connect expert with no proof or certification, you probably thought that this is a bit inconvenient, but an easy fix.",["$","br",null,{}],"\n","I just need to reset the offset for the specific consumer group and recreate the connector. Right?? It's so simple!",["$","br",null,{}],"\n","So that's exactly what I did."]}],"\n",["$","h3",null,{"className":"mt-8 scroll-m-20 text-2xl font-semibold tracking-tight","id":"trying-to-fix-the-issue-on-the-kafka-side","children":[["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4 subheading-anchor","aria-label":"Link to section","href":"#trying-to-fix-the-issue-on-the-kafka-side","children":["$","span",null,{"className":"icon icon-link"}]}],"Trying to fix the issue on the Kafka side"]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","children":["\n",["$","li",null,{"className":"mt-2","children":"I first deleted the Snowflake connector by sending a DELETE request to the Kafka Connect connector endpoint"}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"bash","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"bash","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#B392F0"},"children":"curl"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"-X"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"DELETE"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"http://localhost:8083/connectors/MY_CONNECTOR_NAME"}]]}]}]}]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","start":"2","children":["\n",["$","li",null,{"className":"mt-2","children":["Then I had to stop all consumers with that specific consumer group (",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"consumer.group.id"}],"). Since you can't change offsets with an ACTIVE/STABLE group, the group must be ",["$","strong",null,{"children":"INACTIVE"}],". If you have a consumer for DLQ (dead letter queue), don't forget to turn that one off too.",["$","br",null,{}],"\n","To check if there are active consumers, you can use ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"kafka-consumer-groups.sh"}]," script that comes with every Kafka installation"]}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"bash","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"bash","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#B392F0"},"children":"./bin/kafka-consumer-groups.sh"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--bootstrap-server"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"localhost:9092"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--command-config"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"config/client-ssl.properties"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--group"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"ExampleFooGroup"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--describe"}]]}]}]}]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","start":"3","children":["\n",["$","li",null,{"className":"mt-2","children":"After all the consumers are stopped and the group is in an INACTIVE state, I used the same script to reset the offsets"}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"bash","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"bash","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#B392F0"},"children":"./bin/kafka-consumer-groups.sh"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--bootstrap-server"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"localhost:9092"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--command-config"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"config/client-ssl.properties"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--reset-offsets"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--to-earliest"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--group"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"ExampleFooGroup"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--topic"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"MyExampleTopic"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#79B8FF"},"children":"--execute"}]]}]}]}]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":[["$","em",null,{"children":["This will only reset offsets for ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"MyExampleTopic"}]," topic, if you want to reset offsets for all topic you can use ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"--all-topics"}]," flag instead of ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"--topic"}],"."]}],["$","br",null,{}],"\n","4. I checked the offsets again to make sure the reset happened and recreated the connector"]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["After doing all the steps, the issue ",["$","strong",null,{"children":"was still there"}]," and the connector was still looking at the old offsets.",["$","br",null,{}],"\n","Since I set up and deployed several Kafka Connect clusters and am familiar with a lot of the configuration properties, especially in distributed mode, I was almost certain that the offsets were stored in the topic that was configured via the property ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"offset.storage.topic"}],".",["$","br",null,{}],"\n","I inspected the topic and, to my surprise, the topic was empty. I double checked everything in case I misconfigured or missed something but everything was looking good. After some research, I found this ",["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4","href":"https://groups.google.com/g/confluent-platform/c/Zy0I-dJMydM?pli=1","children":"Google Groups conversation"}]," where it says that the ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"offset.storage.topic"}]," is used only for ",["$","strong",null,{"children":"source connectors"}],".",["$","br",null,{}],"\n","Sink connectors use the main ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"__consumer_offsets"}]," topic to store offsets which also stores all the other offsets for all consumer groups in the cluster."]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":"I was confused since I read the documentation for that property a few times and I couldn't recall it mentioning that the property was only for source connectors. I went to check the docs again and there was no mention that the topic is for source connectors only. Not a skill issue, just missing info in the docs; ego restored, let's continue."}],"\n",["$","blockquote",null,{"className":"mt-6 border-l-2 border-zinc-300 pl-6 italic text-zinc-800 [&>*]:text-zinc-600","children":["\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["$","em",null,{"children":["One similar thing that is mentioned in the docs but can be easily overlooked and is not that obvious is that ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"group.id"}]," for ",["$","strong",null,{"children":"sink connectors"}]," is derived from the ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"consumer.group.id"}],"."]}]}],"\n"]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":"Anyways, I recreated the topic just to be sure but the issue was still there. So the only idea I had left was that the offsets were stored somewhere in Snowflake."}],"\n",["$","h3",null,{"className":"mt-8 scroll-m-20 text-2xl font-semibold tracking-tight","id":"trying-to-fix-the-issue-on-the-snowflake-side","children":[["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4 subheading-anchor","aria-label":"Link to section","href":"#trying-to-fix-the-issue-on-the-snowflake-side","children":["$","span",null,{"className":"icon icon-link"}]}],"Trying to fix the issue on the Snowflake side"]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["I opened the Snowsight console and started inspecting the tables that were mapped to the topics which were causing the offset mismatch issues. If you are not familiar with how Snowflake connectors store the data, basically it creates two columns in the specified table, one for the metadata called ",["$","em",null,{"children":"RECORD_METADATA"}]," and one for the messages called ",["$","em",null,{"children":"RECORD_CONTENT"}],". Since ",["$","em",null,{"children":"RECORD_CONTENT"}]," are just the deserialized messages, the only interesting column that was left was ",["$","em",null,{"children":"RECORD_METADATA"}],".",["$","br",null,{}],"\n","I inspected the column and interestingly enough, the offset was stored in the metadata!",["$","br",null,{}],"\n","Okay, okay, we're onto something here... or at least I thought...",["$","br",null,{}],"\n","My idea was that if I clear/empty those columns, then the offsets will be gone and the connector will start from the beginning. So I did just that."]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","children":["\n",["$","li",null,{"className":"mt-2","children":"I backed up the table in case something went wrong"}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"sql","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"sql","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"create"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"table"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#B392F0"},"children":"MY_TABLE_BACKUP"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" clone MY_TABLE;"}]]}]}]}]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","start":"2","children":["\n",["$","li",null,{"className":"mt-2","children":"Cleared the RECORD_METADATA column aka set it to NULL"}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"sql","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"sql","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"update"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" MY_TABLE "}],["$","span",null,{"style":{"color":"#F97583"},"children":"set"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" RECORD_METADATA "}],["$","span",null,{"style":{"color":"#F97583"},"children":"="}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"NULL"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":";"}]]}]}]}]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","start":"3","children":["\n",["$","li",null,{"className":"mt-2","children":"Recreated the Snowflake connector"}],"\n",["$","li",null,{"className":"mt-2","children":"Profit???"}],"\n"]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["Having already spent more time than I planned on this, I was eagerly waiting for the connector to come up just to see that nothing has changed, the issue was still there. ðŸ˜¢",["$","br",null,{}],"\n","I didn't give up, I had one more idea to try!"]}],"\n",["$","h3",null,{"className":"mt-8 scroll-m-20 text-2xl font-semibold tracking-tight","id":"last-try-and-final-fix","children":[["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4 subheading-anchor","aria-label":"Link to section","href":"#last-try-and-final-fix","children":["$","span",null,{"className":"icon icon-link"}]}],"Last try and final fix"]}],"\n",["$","hr",null,{"className":"my-4 border-zinc-200 md:my-8"}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["$","strong",null,{"children":["UPDATE: Big thanks to ",["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4","href":"https://medium.com/@niv.a_4285","children":"Niv Atzmon"}]," for reaching out and letting me know that there is a better fix than the one I originally found. I won't delete the one I found but I will label it as \"workaround\". In case that this fix doesn't work for you, you can always try the workaround. Feel free to skip to the \"Final fix\" section and try that one first."]}]}],"\n",["$","hr",null,{"className":"my-4 border-zinc-200 md:my-8"}],"\n",["$","h4",null,{"className":"mt-8 scroll-m-20 text-xl font-semibold tracking-tight","id":"workaround","children":[["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4 subheading-anchor","aria-label":"Link to section","href":"#workaround","children":["$","span",null,{"className":"icon icon-link"}]}],"Workaround"]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":"Since I tried almost all the ideas I had, the only thing left I could think of was to recreate the Snowflake tables. I couldn't afford to lose the data so I had to also create backups for all the tables."}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","children":["\n",["$","li",null,{"className":"mt-2","children":"I first backed up all tables that had the offset mismatch issue"}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"sql","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"sql","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"create"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"table"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#B392F0"},"children":"MY_TABLE_BACKUP"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" clone MY_TABLE;"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"create"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"table"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#B392F0"},"children":"MY_TABLE_2_BACKUP"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" clone MY_TABLE_2;"}]]}]]}]}]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","start":"2","children":["\n",["$","li",null,{"className":"mt-2","children":"Dropped the old tables"}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"sql","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"sql","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"drop"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"table"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" MY_TABLE;"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"drop"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"table"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" MY_TABLE_2;"}]]}]]}]}]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","start":"3","children":["\n",["$","li",null,{"className":"mt-2","children":"Cloned the backup tables into new tables that had same names as the ones that were having offset issues"}],"\n"]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"sql","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"sql","data-theme":"default","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"create"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"table"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#B392F0"},"children":"MY_TABLE"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" clone MY_TABLE_BACKUP;"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"create"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#F97583"},"children":"table"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" "}],["$","span",null,{"style":{"color":"#B392F0"},"children":"MY_TABLE_2"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":" clone MY_TABLE_2_BACKUP;"}]]}]]}]}]}],"\n",["$","ol",null,{"className":"my-6 ml-6 list-decimal","start":"4","children":["\n",["$","li",null,{"className":"mt-2","children":"Restarted the connector"}],"\n"]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["Surprisingly enough, this ",["$","strong",null,{"children":"actually worked"}],"! ðŸŽ‰ðŸŽ‰"]}],"\n",["$","h4",null,{"className":"mt-8 scroll-m-20 text-xl font-semibold tracking-tight","id":"final-fix","children":[["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4 subheading-anchor","aria-label":"Link to section","href":"#final-fix","children":["$","span",null,{"className":"icon icon-link"}]}],"Final fix"]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["What if I told you that there is a fix that doesn't require you dropping your tables and resetting the offset to 0, but rather it lets you set the offset to your desired value?",["$","br",null,{}],"\n","Sounds great, but it's not that easy to find.",["$","br",null,{}],"\n","If you dig deep enough, you will stumble upon system functions in Snowflake and there is one function that is especially interesting to us. The function is called ",["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4","href":"https://docs.snowflake.com/en/sql-reference/functions/system_snowpipe_streaming_update_channel_offset_token","children":"SYSTEM$SNOWPIPE_STREAMING_UPDATE_CHANNEL_OFFSET_TOKEN"}],".\nIf you read the description of the function, it says ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"\"Updates the offset token for a particular channel used by Snowpipe Streaming with a new offset token.\""}]," which means that the real location of the offset is in the channel. Now that I think about it, it actually makes sense..."]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":"So to finally fix the issue and reset/set the offset, the only thing left to do is to run the function with your table name, channel name and desired offset."}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"sql","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"sql","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#F97583"},"children":"SYSTEM"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":"$$SNOWPIPE_STREAMING_UPDATE_CHANNEL_OFFSET_TOKEN("}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"'<dbName>.<schemaName>.<tableName>'"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":", "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"'<channelName>'"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":", "}],["$","span",null,{"style":{"color":"#9ECBFF"},"children":"'<new_offset_token>'"}],["$","span",null,{"style":{"color":"#E1E4E8"},"children":");"}]]}]}]}]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["$","em",null,{"children":["To reset the offset, set ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"<new_offset_token>"}]," to ",["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","children":"-1"}],"."]}]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["In case that you're not sure what the name of your channel is, you can run ",["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4","href":"https://docs.snowflake.com/en/sql-reference/sql/show-channels","children":"SHOW CHANNELS"}]]}],"\n",["$","div",null,{"data-rehype-pretty-code-fragment":"","children":["$","pre",null,{"className":"mt-6 mb-4 overflow-x-auto rounded-lg bg-zinc-900 py-4","style":{"backgroundColor":"#24292e"},"tabIndex":"0","data-language":"sql","data-theme":"default","children":["$","code",null,{"className":"relative rounded border bg-zinc-300 bg-opacity-25 py-[0.2rem] px-[0.3rem] font-mono text-sm text-zinc-600","data-language":"sql","data-theme":"default","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#E1E4E8"},"children":"SHOW CHANNELS;"}]}]}]}]}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":"Keep in mind that to edit the channel, you will need to use a role that has write permissions on the targeted table."}],"\n",["$","p",null,{"className":"leading-7 [&:not(:first-child)]:mt-6","children":["Thanks again to ",["$","$Lf",null,{"className":"font-medium text-zinc-900 underline underline-offset-4","href":"https://medium.com/@niv.a_4285","children":"Niv Atzmon"}]," and the Snowflake team for a more elegant solution."]}]]}]}]]}]
a:null
